# Workflow that will run a set of MD simulations in as parallel a manner as
# resources allow. Each simulation uses the same MD protocol, but reads and
# writes data from a unique subdirectory.

workflow:
    dryrun: True
    stages:
        - stage1

stage1:
    steps:
        - ix1
        - amber

ix1:
    type: interfacekernel
    configuration: 
        - shared   $= /home/ubuntu/shared/multirun
        - rep      ]= {reps}
        - workdir  $= {shared}/{rep}
        
amber:
    type: subprocesskernel
    configuration: >
        mpirun -np 2 pmemd.MPI -O -c {workdir}/{inpcrd}
        -p {workdir}/{parmtop}
        -i {shared}/{mdin}
        -x {workdir}/{trajfile}

inputs:
    - parmtop # topology file
    - mdin # MD input file
    - inpcrd # starting coordinates
    - trajfile # name of output trajectory file
    - reps # list of replicate subdirectory names
