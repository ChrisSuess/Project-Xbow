#!/usr/bin/env python
from __future__ import print_function
from xbowflow._version import __version__

from dask.distributed import Client
from xbowflow.pipelines import SubprocessKernel, Pipeline
import sys
import os
import socket

ip = socket.gethostbyname(socket.gethostname())
dask_scheduler = '{}:8786'.format(ip)
try:
    client = Client(dask_scheduler)
iexcept IOError:
    client = Client()
cmd = ' '.join(sys.argv[1:])

full_cmd = 'cd {}; {}'.format(os.getcwd(), cmd)
kernel = SubprocessKernel(full_cmd)
pipe = Pipeline(client, [kernel])
result = pipe.run({})
print(result['output'])
client.close()
